<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>广州参考幻灯片</title>

    <!-- bootstrap bootstrap-table  jquery -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="__STATIC__/bootstrap-table1/bootstrap-table.css">
    <script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="__STATIC__/bootstrap-table1/bootstrap-table.js"></script>
    <!-- put your locale files after bootstrap-table.js -->
    <script src="__STATIC__/bootstrap-table1/bootstrap-table-zh-CN.js"></script>
    <!-- x-editable -->
    <link href="__STATIC__/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet">
    <script src="__STATIC__/bootstrap3-editable/js/bootstrap-editable.js"></script>
    <!-- bootstrap extensions table-editable -->
    <script src="__STATIC__/bootstrap-table1/editable/bootstrap-table-editable.js"></script>
    <!-- 所有文件加载结束 -->

</head>

<body>
<td>
    <button type="button" class="btn btn-primary" onclick="window.open('/index.php/media_admin/Slide/showadd/id/{$id}','_self')">添加文章</button>
</td>
<td>
    <button type="button" class="btn btn-info" onclick="window.history.go(-1)">返回专题列表</button>
</td>
<table id ="tb_user"></table>

</body>
<script>
    //php var
    var apiUrl = "{$API_URL}";
    var id ="{$id}";
    var loadDataUrl = apiUrl +"/load/id/"+id;
    var editUrl = apiUrl + "/edit/tid/" +id;
    var keyIdName = "key";
   // console.log(apiUrl,id);
    $table =$("#tb_user");
    function operateFormatter( value,row,index) {
        return [
            // '<a class="addlink" href="javascript:void(0)" title="添加文章链接">',
            // '<i class="glyphicon glyphicon-plus"></i>',
            // '</a> &nbsp;&nbsp;| ',
            // '<a class="showimage" href="javascript:void(0)" title="显示所有图片链接">',
            // '<i class="glyphicon glyphicon-th-list"></i>',
            // '</a> | ',
            '<a class="editlink" href="javascript:void(0)" title="编辑文章">',
            '<i class="glyphicon glyphicon-edit"></i>',
            '</a> &nbsp;&nbsp;| ',
            // '<a class="showlink" href="javascript:void(0)" title="显示文章内容">',
            // '<i class="glyphicon glyphicon-th-list"></i>',
            // '</a> &nbsp;&nbsp;| ',
            '<a class="deletelink" href="javascript:void(0)" title="删除文章">',
            '<i class="glyphicon glyphicon-alert"></i>',
            '</a> &nbsp;&nbsp; ',
        ].join('');
    }
        window.operateEvents = {
        // 'click .addimage': function (e,value,row,index) {
        //     var rowid = row.id;
        //     console.log({apiUrl,id});
        //     window.location.href = apiUrl+"/showaddimage"+"/id/"+id+"/nid/"+rowid;
        // },
        // 'click .addlink': function (e,value,row,index) {
        //     var rowid = row.id;
        //     console.log({apiUrl,id});
        //     window.location.href = apiUrl+"/showaddlink"+"/id/"+id+"/nid/"+rowid;
        // },
        'click .editlink': function (e,value,row,index) {
            var rowid = row.id;
            console.log({apiUrl,id});
            window.location.href = apiUrl+"/showeditlink"+"/id/"+id+"/nid/"+rowid;
        },
        // 'click .showimage':function (e,value,row,index) {
        //     var rowid = row.id;
        //     console.log({id,editUrl});
        //     window.location.href = apiUrl +"/showimage"+"/id/"+id+"/nid/"+rowid;
        //
        // },
        // 'click .showlink':function (e,value,row,index) {
        //     var rowid = row.id;
        //     console.log({id,editUrl});
        //     window.location.href = apiUrl +"/showlink"+"/id/"+id+"/nid/"+rowid;
        // },
        'click .deletelink':function (e,value,row,index) {
             var nid = row.id;
             deleteurl = apiUrl+"/deletelink"+"/id/"+id+"/nid/"+nid;

            if(confirm("您确认要删除吗")){
                $.ajax({
                    url:deleteurl,
                    type:"POST",
                    success:function (data) {
                        if (data.msg == '删除成功'){
                            console.log(data);
                            $(this).parent().parent().remove();
                            alert('删除成功');
                            window.location.reload();
                        }
                    },
                    error:function () {
                        console.log("error");
                        alert("删除失败");
                        window.location.reload();
                    }
                })
            }
        }
    };
    // window.operateEvents = {
    //     'click .addlink': function (e,value,row,index) {
    //         var rowid = row.id;
    //         var id = "{$id}";
    //         console.log({ apiUrl,id});
    //         window.location.href= apiUrl + "/showaddlink" + "/id/"+id+"/nid/" + rowid;
    //     },
    //     'click .showlink': function (e, val,row,index) {
    //         var rowid = row.id;
    //         window.location.href= apiUrl + "/showlink"+ "/id/"+id+ "/nid/" + rowid;
    //
    //     }
    // };
    $(function () {
        $table.bootstrapTable({
            toolbar: "#toolbar",
            idField: keyIdName,
            pagination:true,
            showRefresh:true,
            search:true,
            clickToSelect:true,
            queryParams:function (param) {
                return{};
            },
            url: loadDataUrl,
            pageSize:20,
            columns:[
                {
                    field:"id",
                    title: "文章id",
                },
                // {
                //     field:"date",
                //     title:"创建日期",
                //     edittable:{
                //         type:"text",
                //         title:'归类的日期',
                //         validate:function (v) {
                //             var regx =/^(?:(?:0[1-9])|(?:1[0-2]))月(?:(?:[0-2][1-9])|(?:[1-3][0-1]))日$/;
                //             if (!regx.test(v)) {
                //                 return "日期格式为 09月21日"
                //             }
                //         }
                //     }
                // },
                {
                    field:"title",
                    title:"标题",
            
                    editable:{
                        type:'text',
                        title:'标题',
                        validate:function (v) {
                            if(!v) return '标题不能为空';
                        }
                    }
                },
                {
                    field:"sub_title",
                    title:"副标题",
                    
                    editable: {
                        type:'text',
                        title:'子标题',
                    }
                },
                // {
                //     field:"image_ids",
                //     title:"标题图片",
                //
                // },
                // {
                //     field:"image_url",
                //     title:"标题图片链接",
                //     width:"80px",
                //     editable: {
                //         type:'text',
                //         title:'图片链接',
                //     }
                // },
                // {
                //     field:"link_ids",
                //     title:"文章内容",
                //
                // },
                {
                    field:"status",
                    title:"状态",
                    editable:{
                        type:'text',
                        title:'1为有效，0为失败'
                    }
                },
                {
                    field:"iorder",
                    title:"排序号",
                    editable:{
                        type:'number',
                        title:'排序号,从高到低'
                    }
                },
                {
                    field:"ctime",
                    title:"创建日期",
                },
                {
                    field:"operate",
                    title:"文章内容操作选项",
                    align:"center",
                    events: operateEvents,
                    formatter: operateFormatter
                }
            ],
            onEditableSave:function(filed,row,oldValue ,$el){
                $.ajax({
                    type:"post",
                    url: editUrl,
                    data:row,
                    dataType:'JSON',
                    success:function (data,status) {
                        if(status == 'success'){
                            console.log(data);
                            alert('提交数据成功');
                        }
                    },
                    error:function () {
                        alert('编辑失败');
                    },
                    complete:function () {

                    }
                });
            }


        });
    });
</script>

</html>