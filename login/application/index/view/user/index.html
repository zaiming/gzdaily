<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户列表</title>
    <link href="/login/public/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm-12">

            <button type="button" class="btn btn-info" onclick="addUser()">增加用户</button>

            <table class="table table-striped" id = "view">
                <thead>
                <tr>
                    <th>用户ID</th>
                    <th>用户名</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {foreach name="$user_list" item="vo"}
                <tr>
                    <td>{$vo->id}</td>
                    <td>{$vo->user_name}</td>

                    <td>
                        <button type="button" class="btn btn-primary" onclick="editUser({$vo:id})">编辑</button>
                        <!--<a href="{:url('user/userDel', ['uid' => $vo->id])}">-->
                            <!--<button type="button" class="btn btn-danger">删除</button>-->
                        <!--</a>-->
                        <button type="button" class="btn btn-danger" onclick="delUser({$vo:id})">删除</button>
                    </td>
                </tr>
                {/foreach}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="/login/public/static/js/jquery.min.js?v=2.1.4"></script>
<script src="/login/public/static/bootstrap/js/bootstrap.min.js"></script>

<!-- 页面层增加用户开始 -->
<div class="form-horizontal col-sm-12" id="box" style="display:none;margin-top: 15px">
    <div class="form-group">
        <label for="user_name" class="col-sm-2 control-label">用户名</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="user_name" placeholder="用户名">
        </div>
    </div>
    <div class="form-group">
        <label for="user_pwd" class="col-sm-2 control-label">密码</label>
        <div class="col-sm-10">
            <input type="password" class="form-control" id="user_pwd" placeholder="密码">
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-offset-6 col-sm-6">
            <button type="button" class="btn btn-default" id="btn">提交</button>
        </div>
    </div>
</div>
<!-- 页面层增加用户结束 -->


<!-- 页面层编辑用户开始 -->
<div class="form-horizontal col-sm-12" id="edit_box" style="display:none;margin-top: 15px">
    <input type="hidden" id="id">
    <div class="form-group">
        <label for="user_name" class="col-sm-2 control-label">用户名</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="e_user_name" placeholder="用户名">
        </div>
    </div>
    <div class="form-group">
        <label for="user_pwd" class="col-sm-2 control-label">旧密码</label>
        <div class="col-sm-10">
            <input type="password" class="form-control" id="old_user_pwd" placeholder="旧密码">
        </div>
    </div>
    <div class="form-group">
        <label for="user_pwd" class="col-sm-2 control-label">新密码</label>
        <div class="col-sm-10">
            <input type="password" class="form-control" id="new_user_pwd" placeholder="新密码">
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-offset-6 col-sm-6">
            <button type="button" class="btn btn-default" id="btn_edit">提交</button>
        </div>
    </div>
</div>
<!-- 页面层编辑用户结束 -->


<script src="/login/public/static/layer/layer.js"></script>
<script>
    $(function(){
        $("#btn").click(function(){

            var user_name = $("#user_name").val();
            var user_pwd = $("#user_pwd").val();
            if('' == user_name){
                layer.tips('用户名不能为空', '#user_name');
                return false;
            }
            if('' == user_pwd){
                layer.tips('密码不能为空', '#user_pwd');
                return false;
            }

            $.post("{:url('User/addUser')}", {user_name: user_name, user_pwd: user_pwd}, function(res){
                if(1 == res.code){
                    window.location.reload();
                }else{
                    layer.alert(res.msg, {icon:2, title: '错误提示'});
                }
            }, 'json');
        });

    });
    // 页面层增加用户
    var box;
    function addUser(){

        // box = layer.open({
        //     title: '增加用户',
        //     type: 1,
        //     skin: 'layui-layer-rim', //加上边框
        //     area: ['450px', '240px'], //宽高
        //     content: $("#box")
        // });
        box = layer.open({
             title: '增加用户',
             type:2,
             skin:'layui-layer-rim',//加上边框
             area:['480px','290'],
             content:"{:url('user/adduser')}"
         });
     }
     function refresh() {
         window.location.reload();
     }
    //页面编辑用户
    // 页面层编辑用户
    function editUser(uid){

        $.getJSON("{:url('user/edituser')}", {uid: uid}, function(res){
            $("#id").val(res.data.id);
            $("#e_user_name").val(res.data.user_name);

            box = layer.open({
                title: '编辑用户',
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['500px', '270px'], //宽高
                content: $("#edit_box")
            });
        });
    }

    // 点击编辑用户按钮
    $("#btn_edit").click(function(){

        var user_name = $("#e_user_name").val();
        var old_pwd = $("#old_user_pwd").val();
        var new_pwd = $("#new_user_pwd").val();
        var id = $("#id").val();

        if('' == user_name){
            layer.tips('用户名不能为空', '#e_user_name');
            return false;
        }

        $.post("{:url('user/edituser')}",
            {
                user_name: user_name,
                old_pwd: old_pwd,
                new_pwd: new_pwd,
                id: id
            }, function(res){
                if(1 == res.code){
                    window.location.reload();
                }else{
                    layer.alert(res.msg, {icon:2, title: '错误提示'});
                }
            }, 'json');
    });

    // 删除用户
    function delUser(uid){

        //询问框
        layer.confirm('确定删除此用户？', {
            title: '友情提示',
            icon: 3,
            closeBtn: 0,
            btn: ['确定','取消'] //按钮
        }, function(){

            $.getJSON("{:url('user/deluser')}", {uid: uid}, function(res){

                if(1 == res.code){
                    window.location.reload();
                }else{
                    layer.alert(res.msg, {icon:2, title: '错误提示'});
                }
            });
        }, function(){

        });
    }

</script>

</body>
</html>